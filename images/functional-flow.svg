<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2563eb" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#16a34a" />
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7c3aed" />
    </marker>
    <filter id="shadow">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="600" y="35" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#1e293b" text-anchor="middle">
    RAG System - Complete Functional Flow
  </text>
  <text x="600" y="55" font-family="Arial, sans-serif" font-size="12" fill="#64748b" text-anchor="middle">
    Document Ingestion → Intelligent Retrieval → AI-Powered Response Generation
  </text>

  <!-- INGESTION FLOW -->
  <g id="ingestion-flow">
    <!-- Input Sources -->
    <rect x="50" y="90" width="160" height="200" rx="10" fill="#dbeafe" stroke="#2563eb" stroke-width="3" filter="url(#shadow)"/>
    <text x="130" y="115" font-family="Arial" font-size="14" font-weight="bold" fill="#1e40af" text-anchor="middle">Input Sources</text>
    <line x1="70" y1="125" x2="190" y2="125" stroke="#2563eb" stroke-width="1"/>
    <text x="130" y="145" font-family="Arial" font-size="11" fill="#1e40af" text-anchor="middle">Documents</text>
    <text x="80" y="165" font-family="Arial" font-size="9" fill="#1e40af">• PDF, DOCX, TXT</text>
    <text x="80" y="180" font-family="Arial" font-size="9" fill="#1e40af">• Markdown, Code</text>
    <text x="80" y="200" font-family="Arial" font-size="11" fill="#1e40af" font-weight="bold">Multi-Modal</text>
    <text x="80" y="215" font-family="Arial" font-size="9" fill="#1e40af">• Images (OCR+AI)</text>
    <text x="80" y="230" font-family="Arial" font-size="9" fill="#1e40af">• Audio (Transcribe)</text>
    <text x="80" y="245" font-family="Arial" font-size="9" fill="#1e40af">• Video (Frames)</text>
    <text x="130" y="270" font-family="Arial" font-size="10" fill="#1e40af" font-style="italic">Upload via API</text>

    <!-- Multi-Modal Processing -->
    <rect x="260" y="90" width="180" height="200" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="3" filter="url(#shadow)"/>
    <text x="350" y="115" font-family="Arial" font-size="14" font-weight="bold" fill="#92400e" text-anchor="middle">Processing</text>
    <line x1="280" y1="125" x2="420" y2="125" stroke="#f59e0b" stroke-width="1"/>
    <text x="350" y="145" font-family="Arial" font-size="10" fill="#92400e" text-anchor="middle" font-weight="bold">Content Extraction</text>
    <text x="280" y="165" font-family="Arial" font-size="9" fill="#92400e">• Text parsing</text>
    <text x="280" y="180" font-family="Arial" font-size="9" fill="#92400e">• Vision analysis</text>
    <text x="280" y="195" font-family="Arial" font-size="9" fill="#92400e">• Audio transcription</text>
    <text x="350" y="215" font-family="Arial" font-size="10" fill="#92400e" text-anchor="middle" font-weight="bold">Chunking Strategies</text>
    <text x="280" y="230" font-family="Arial" font-size="9" fill="#92400e">• Semantic chunking</text>
    <text x="280" y="245" font-family="Arial" font-size="9" fill="#92400e">• Section-aware split</text>
    <text x="350" y="265" font-family="Arial" font-size="10" fill="#92400e" text-anchor="middle" font-weight="bold">Entity Extraction</text>
    <text x="280" y="280" font-family="Arial" font-size="9" fill="#92400e">• LLM-based NER</text>

    <!-- Embeddings & Graph -->
    <rect x="490" y="90" width="160" height="90" rx="10" fill="#e0e7ff" stroke="#6366f1" stroke-width="3" filter="url(#shadow)"/>
    <text x="570" y="115" font-family="Arial" font-size="13" font-weight="bold" fill="#4338ca" text-anchor="middle">Embeddings</text>
    <text x="570" y="135" font-family="Arial" font-size="9" fill="#4338ca" text-anchor="middle">Generate vectors</text>
    <text x="510" y="155" font-family="Arial" font-size="9" fill="#4338ca">• text-embedding-3</text>
    <text x="510" y="170" font-family="Arial" font-size="9" fill="#4338ca">• 1536 dimensions</text>

    <rect x="490" y="200" width="160" height="90" rx="10" fill="#f3e8ff" stroke="#a855f7" stroke-width="3" filter="url(#shadow)"/>
    <text x="570" y="225" font-family="Arial" font-size="13" font-weight="bold" fill="#6b21a8" text-anchor="middle">Graph Building</text>
    <text x="510" y="245" font-family="Arial" font-size="9" fill="#6b21a8">• Entity nodes</text>
    <text x="510" y="260" font-family="Arial" font-size="9" fill="#6b21a8">• Relationships</text>
    <text x="510" y="275" font-family="Arial" font-size="9" fill="#6b21a8">• Document links</text>

    <!-- Storage -->
    <rect x="700" y="90" width="160" height="90" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="3" filter="url(#shadow)"/>
    <text x="780" y="110" font-family="Arial" font-size="13" font-weight="bold" fill="#166534" text-anchor="middle">Weaviate</text>
    <text x="780" y="130" font-family="Arial" font-size="11" fill="#166534" text-anchor="middle">Vector Database</text>
    <text x="720" y="150" font-family="Arial" font-size="9" fill="#166534">• HNSW indexing</text>
    <text x="720" y="165" font-family="Arial" font-size="9" fill="#166534">• Semantic search</text>

    <rect x="700" y="200" width="160" height="90" rx="10" fill="#dbeafe" stroke="#0284c7" stroke-width="3" filter="url(#shadow)"/>
    <text x="780" y="220" font-family="Arial" font-size="13" font-weight="bold" fill="#075985" text-anchor="middle">Neo4j</text>
    <text x="780" y="240" font-family="Arial" font-size="11" fill="#075985" text-anchor="middle">Graph Database</text>
    <text x="720" y="260" font-family="Arial" font-size="9" fill="#075985">• Knowledge graph</text>
    <text x="720" y="275" font-family="Arial" font-size="9" fill="#075985">• Relationships</text>

    <!-- Arrows for ingestion -->
    <line x1="210" y1="190" x2="260" y2="190" stroke="#2563eb" stroke-width="3" marker-end="url(#arrowhead)"/>
    <line x1="440" y1="135" x2="490" y2="135" stroke="#6366f1" stroke-width="2.5" marker-end="url(#arrowhead)"/>
    <line x1="440" y1="245" x2="490" y2="245" stroke="#a855f7" stroke-width="2.5" marker-end="url(#arrowhead-purple)"/>
    <line x1="650" y1="135" x2="700" y2="135" stroke="#16a34a" stroke-width="2.5" marker-end="url(#arrowhead-green)"/>
    <line x1="650" y1="245" x2="700" y2="245" stroke="#0284c7" stroke-width="2.5" marker-end="url(#arrowhead)"/>
  </g>

  <!-- QUERY FLOW -->
  <g id="query-flow">
    <rect x="50" y="350" width="160" height="100" rx="10" fill="#fce7f3" stroke="#ec4899" stroke-width="3" filter="url(#shadow)"/>
    <text x="130" y="375" font-family="Arial" font-size="14" font-weight="bold" fill="#9f1239" text-anchor="middle">User Query</text>
    <line x1="70" y1="385" x2="190" y2="385" stroke="#ec4899" stroke-width="1"/>
    <text x="130" y="405" font-family="Arial" font-size="10" fill="#9f1239" text-anchor="middle">Natural language</text>
    <text x="130" y="425" font-family="Arial" font-size="9" fill="#9f1239" text-anchor="middle">"What is RAG?"</text>

    <!-- Retrieval Strategies -->
    <rect x="260" y="330" width="200" height="140" rx="10" fill="#f0f9ff" stroke="#0369a1" stroke-width="3" filter="url(#shadow)"/>
    <text x="360" y="355" font-family="Arial" font-size="14" font-weight="bold" fill="#0c4a6e" text-anchor="middle">Retrieval Strategies</text>
    <line x1="280" y1="365" x2="440" y2="365" stroke="#0369a1" stroke-width="1"/>
    <text x="280" y="385" font-family="Arial" font-size="9" fill="#0c4a6e">1. <tspan font-weight="bold">VECTOR</tspan> - Semantic similarity</text>
    <text x="280" y="400" font-family="Arial" font-size="9" fill="#0c4a6e">2. <tspan font-weight="bold">GRAPH</tspan> - Relationship traversal</text>
    <text x="280" y="415" font-family="Arial" font-size="9" fill="#0c4a6e">3. <tspan font-weight="bold">HYBRID</tspan> - RRF fusion</text>
    <text x="280" y="430" font-family="Arial" font-size="9" fill="#0c4a6e">4. <tspan font-weight="bold">HyDE</tspan> - Hypothetical docs</text>
    <text x="280" y="445" font-family="Arial" font-size="9" fill="#0c4a6e">5. <tspan font-weight="bold">DECOMP</tspan> - Sub-queries</text>
    <text x="360" y="462" font-family="Arial" font-size="9" fill="#0c4a6e" text-anchor="middle" font-style="italic">AUTO selection</text>

    <!-- Retrieved Context -->
    <rect x="510" y="350" width="150" height="100" rx="10" fill="#fef9c3" stroke="#ca8a04" stroke-width="3" filter="url(#shadow)"/>
    <text x="585" y="375" font-family="Arial" font-size="13" font-weight="bold" fill="#713f12" text-anchor="middle">Context</text>
    <text x="585" y="395" font-family="Arial" font-size="10" fill="#713f12" text-anchor="middle">Retrieved chunks</text>
    <text x="530" y="415" font-family="Arial" font-size="9" fill="#713f12">• Reranking</text>
    <text x="530" y="430" font-family="Arial" font-size="9" fill="#713f12">• Compression</text>

    <!-- LLM Generation -->
    <rect x="710" y="350" width="150" height="100" rx="10" fill="#fef2f2" stroke="#dc2626" stroke-width="3" filter="url(#shadow)"/>
    <text x="785" y="375" font-family="Arial" font-size="13" font-weight="bold" fill="#991b1b" text-anchor="middle">LLM</text>
    <text x="785" y="395" font-family="Arial" font-size="10" fill="#991b1b" text-anchor="middle">Generation</text>
    <text x="730" y="415" font-family="Arial" font-size="9" fill="#991b1b">• GPT-4</text>
    <text x="730" y="430" font-family="Arial" font-size="9" fill="#991b1b">• ProxyLLM</text>

    <!-- Response -->
    <rect x="910" y="350" width="160" height="100" rx="10" fill="#d1fae5" stroke="#059669" stroke-width="3" filter="url(#shadow)"/>
    <text x="990" y="375" font-family="Arial" font-size="14" font-weight="bold" fill="#065f46" text-anchor="middle">Response</text>
    <line x1="930" y1="385" x2="1050" y2="385" stroke="#059669" stroke-width="1"/>
    <text x="930" y="405" font-family="Arial" font-size="9" fill="#065f46">• Answer</text>
    <text x="930" y="420" font-family="Arial" font-size="9" fill="#065f46">• Source citations</text>
    <text x="930" y="435" font-family="Arial" font-size="9" fill="#065f46">• Confidence scores</text>

    <!-- Query flow arrows -->
    <line x1="210" y1="400" x2="260" y2="400" stroke="#ec4899" stroke-width="3" marker-end="url(#arrowhead)"/>
    <line x1="460" y1="400" x2="510" y2="400" stroke="#0369a1" stroke-width="3" marker-end="url(#arrowhead)"/>
    <line x1="660" y1="400" x2="710" y2="400" stroke="#ca8a04" stroke-width="2.5" marker-end="url(#arrowhead)"/>
    <line x1="860" y1="400" x2="910" y2="400" stroke="#dc2626" stroke-width="2.5" marker-end="url(#arrowhead)"/>

    <!-- Database connections -->
    <path d="M 360 330 Q 360 250 780 180" stroke="#0369a1" stroke-width="2" stroke-dasharray="5,5" fill="none" opacity="0.6"/>
    <path d="M 360 330 Q 360 280 780 245" stroke="#0369a1" stroke-width="2" stroke-dasharray="5,5" fill="none" opacity="0.6"/>
    <text x="500" y="250" font-family="Arial" font-size="8" fill="#64748b" transform="rotate(-15 500 250)">Query DBs</text>
  </g>

  <!-- MONITORING & QUALITY -->
  <g id="monitoring">
    <rect x="50" y="520" width="1020" height="120" rx="10" fill="#fef3c7" stroke="#eab308" stroke-width="3" filter="url(#shadow)"/>
    <text x="560" y="545" font-family="Arial" font-size="15" font-weight="bold" fill="#713f12" text-anchor="middle">Quality, Monitoring &amp; Feedback Loop</text>
    <line x1="70" y1="555" x2="1050" y2="555" stroke="#eab308" stroke-width="1"/>

    <!-- Quality Metrics -->
    <g transform="translate(70, 570)">
      <text x="0" y="0" font-family="Arial" font-size="11" fill="#713f12" font-weight="bold">Quality Evaluation</text>
      <text x="0" y="15" font-family="Arial" font-size="9" fill="#713f12">• Relevance score</text>
      <text x="0" y="28" font-family="Arial" font-size="9" fill="#713f12">• Faithfulness</text>
      <text x="0" y="41" font-family="Arial" font-size="9" fill="#713f12">• Coherence</text>
    </g>

    <!-- Cost Tracking -->
    <g transform="translate(250, 570)">
      <text x="0" y="0" font-family="Arial" font-size="11" fill="#713f12" font-weight="bold">Cost Tracking</text>
      <text x="0" y="15" font-family="Arial" font-size="9" fill="#713f12">• Token usage</text>
      <text x="0" y="28" font-family="Arial" font-size="9" fill="#713f12">• Budget alerts</text>
      <text x="0" y="41" font-family="Arial" font-size="9" fill="#713f12">• $ per query</text>
    </g>

    <!-- Monitoring -->
    <g transform="translate(420, 570)">
      <text x="0" y="0" font-family="Arial" font-size="11" fill="#713f12" font-weight="bold">Monitoring Stack</text>
      <text x="0" y="15" font-family="Arial" font-size="9" fill="#713f12">• Prometheus metrics</text>
      <text x="0" y="28" font-family="Arial" font-size="9" fill="#713f12">• Grafana dashboards</text>
      <text x="0" y="41" font-family="Arial" font-size="9" fill="#713f12">• Health checks</text>
    </g>

    <!-- User Feedback -->
    <g transform="translate(620, 570)">
      <text x="0" y="0" font-family="Arial" font-size="11" fill="#713f12" font-weight="bold">User Feedback</text>
      <text x="0" y="15" font-family="Arial" font-size="9" fill="#713f12">• Thumbs up/down ratings</text>
      <text x="0" y="28" font-family="Arial" font-size="9" fill="#713f12">• Comments</text>
      <text x="0" y="41" font-family="Arial" font-size="9" fill="#713f12">• Continuous learning</text>
    </g>

    <!-- Additional Features -->
    <g transform="translate(820, 570)">
      <text x="0" y="0" font-family="Arial" font-size="11" fill="#713f12" font-weight="bold">Enterprise Features</text>
      <text x="0" y="15" font-family="Arial" font-size="9" fill="#713f12">• PII detection</text>
      <text x="0" y="28" font-family="Arial" font-size="9" fill="#713f12">• Circuit breakers</text>
      <text x="0" y="41" font-family="Arial" font-size="9" fill="#713f12">• Rate limiting</text>
    </g>

    <!-- Feedback arrow -->
    <path d="M 990 430 Q 1100 430 1100 565 Q 1100 620 560 620 Q 150 620 150 470" stroke="#eab308" stroke-width="2" stroke-dasharray="5,5" fill="none" marker-end="url(#arrowhead)" opacity="0.7"/>
    <text x="1080" y="500" font-family="Arial" font-size="8" fill="#713f12">Feedback</text>
  </g>

  <!-- USE CASES -->
  <g id="use-cases">
    <rect x="50" y="680" width="1020" height="90" rx="10" fill="#ede9fe" stroke="#7c3aed" stroke-width="3" filter="url(#shadow)"/>
    <text x="560" y="710" font-family="Arial" font-size="15" font-weight="bold" fill="#5b21b6" text-anchor="middle">Enterprise Use Cases</text>
    <line x1="70" y1="720" x2="1050" y2="720" stroke="#7c3aed" stroke-width="1"/>
    <text x="560" y="745" font-family="Arial" font-size="11" fill="#5b21b6" text-anchor="middle">
      Customer Support • Internal Knowledge Management • Code Assistant • Research Analysis • Compliance Queries
    </text>
    <text x="560" y="762" font-family="Arial" font-size="9" fill="#5b21b6" text-anchor="middle" font-style="italic">
      Deployed via Docker Compose • React UI • Spring Boot API • 4 Databases • Real-time Streaming
    </text>
  </g>

  <!-- Labels -->
  <text x="235" y="195" font-family="Arial" font-size="10" fill="#64748b" font-weight="bold">Ingest</text>
  <text x="465" y="140" font-family="Arial" font-size="10" fill="#64748b" font-weight="bold">Embed</text>
  <text x="675" y="140" font-family="Arial" font-size="10" fill="#64748b" font-weight="bold">Store</text>
  <text x="235" y="405" font-family="Arial" font-size="10" fill="#64748b" font-weight="bold">Search</text>
  <text x="485" y="405" font-family="Arial" font-size="10" fill="#64748b" font-weight="bold">Assemble</text>
  <text x="685" y="405" font-family="Arial" font-size="10" fill="#64748b" font-weight="bold">Generate</text>
  <text x="885" y="405" font-family="Arial" font-size="10" fill="#64748b" font-weight="bold">Return</text>
</svg>
